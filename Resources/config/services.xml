<?xml version="1.0" ?>

<container xmlns="http://symfony.com/schema/dic/services"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://symfony.com/schema/dic/services http://symfony.com/schema/dic/services/services-1.0.xsd">

    <parameters>
        <parameter key="raindrop_page_bundle.page_class">Raindrop\PageBundle\Entity\Page</parameter>
        <parameter key="raindrop_page_bundle.page_repository_class">Raindrop\PageBundle\Entity\PageRepository</parameter>
        <parameter key="raindrop_page_bundle.block_class">Raindrop\PageBundle\Entity\Block</parameter>
        <parameter key="raindrop_page_bundle.block_repository_class">Raindrop\PageBundle\Entity\BlockRepository</parameter>
        <parameter key="raindrop_page.base_action">RaindropPageBundle:Page:index</parameter>
        <parameter key="raindrop_page.page_controller">RaindropPageBundle:Page:index</parameter>
    </parameters>

    <services>
       <service id="raindrop.admin.page" class="Raindrop\PageBundle\Admin\PageAdmin">

          <argument />
          <argument>Raindrop\PageBundle\Entity\Page</argument>
          <argument>SonataAdminBundle:CRUD</argument>

          <tag name="sonata.admin" manager_type="orm" group="page" label="page"/>

          <call method="setTranslationDomain">
              <argument>RaindropPageBundle</argument>
          </call>
          <call method="setContainer">
              <argument type="service" id="service_container" />
          </call>
          <call method="setLayoutProvider">
              <argument type="service" id="raindrop.admin.layout.provider" />
          </call>
          <call method="setBlockProvider">
              <argument type="service" id="raindrop.admin.block.provider" />
          </call>
      </service>

       <service id="raindrop.admin.block" class="Raindrop\PageBundle\Admin\BlockAdmin">
          <tag name="sonata.admin" manager_type="orm" group="page" label="block"/>
          <argument />
          <argument>Raindrop\PageBundle\Entity\Block</argument>
          <argument>SonataAdminBundle:CRUD</argument>
          <call method="setTranslationDomain">
              <argument>RaindropPageBundle</argument>
          </call>
      </service>

       <service id="raindrop.admin.blockVariable" class="Raindrop\PageBundle\Admin\BlockVariableAdmin">
          <tag name="sonata.admin" manager_type="orm" group="page" label="block_variable"/>
          <argument />
          <argument>Raindrop\PageBundle\Entity\BlockVariable</argument>
          <argument>SonataAdminBundle:CRUD</argument>
          <call method="setTranslationDomain">
              <argument>RaindropPageBundle</argument>
          </call>
      </service>

      <service id="raindrop.admin.layout.provider" class="Raindrop\PageBundle\Admin\Providers\LayoutProvider">
          <argument type="service" id="raindrop_twig.template_repository" />
      </service>

      <service id="raindrop.admin.block.provider" class="Raindrop\PageBundle\Admin\Providers\BlockProvider">
          <argument type="service" id="doctrine.orm.entity_manager" />
          <argument>Raindrop\PageBundle\Entity\BlockConfig</argument>
      </service>

        <service id="raindrop_page.page_repository" factory-service="doctrine.orm.entity_manager" factory-method="getRepository" class="%raindrop_page_bundle.page_repository_class%">
            <argument>%raindrop_page_bundle.page_class%</argument>
            <call method="setPrefix"><argument type="string">/route</argument></call>
        </service>

        <service id="raindrop_page.block_repository" factory-service="doctrine.orm.entity_manager" factory-method="getRepository" class="%raindrop_page_bundle.block_repository_class%">
            <argument>%raindrop_page_bundle.block_class%</argument>
        </service>

        <service id="raindrop_page.block.service.template" class="Raindrop\PageBundle\Block\TemplateBlockService">
            <tag name="sonata.block" />
            <argument>raindrop_page.block.service.template</argument>
            <argument type="service" id="templating" />
        </service>

        <service id="raindrop_page.block.manager" class="Raindrop\PageBundle\Manager\BlockManager">
            <argument type="service" id="doctrine.orm.entity_manager" />
        </service>

        <service id="raindrop_page.tree.warmer" class="Raindrop\PageBundle\HttpKernel\WebsiteTreeWarmer" public="false">
            <tag name="kernel.cache_warmer" />
            <argument type="service" id="kernel" />
            <argument type="service" id="service_container" />
            <argument type="service" id="raindrop_page.directory_tree" />
        </service>

        <service id="raindrop_page.directory_tree" class="Raindrop\PageBundle\Directory\Tree">
            <argument type="service" id="raindrop_routing.route_repository" />
        </service>

        <service id="raindrop.block.loader.service" class="Raindrop\PageBundle\Block\Loader\ServiceLoader">
            <tag name="sonata.block.loader" />
            <argument type="service" id="raindrop_page.block_repository" />
        </service>
    </services>

</container>
